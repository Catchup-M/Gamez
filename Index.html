<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Landscape Game â€“ HARD Sprite Bleed Fix</title>

  <meta name="viewport"
        content="width=device-width,
                 height=device-height,
                 initial-scale=1.0,
                 user-scalable=no" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }

    canvas {
      display: block;
    }

    /* =====================
       GROUND
       ===================== */
    #ground {
      position: absolute;
      left: 0;
      bottom: -5px;
      height: 12vw;
      min-height: 80px;
      max-height: 140px;
      z-index: 5;
      pointer-events: none;
    }

    /* =====================
       CHARACTER POSITION (CSS CONTROL)
       ===================== */
    #character-anchor {
      position: absolute;
      left: 50px;
      bottom: 100px; /* ðŸ‘ˆ MOVE CHARACTER HERE */
      width: 120px;
      height: 160px;
      visibility: hidden;
      pointer-events: none;
    }

    /* =====================
       JOYSTICK
       ===================== */
    #joystick-base {
      position: absolute;
      left: 20px;
      bottom: 30px;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgba(255,255,255,0.12);
      border: 2px solid rgba(255,255,255,0.25);
      z-index: 10;
    }

    #joystick-stick {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255,255,255,0.35);
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
  </style>
</head>

<body>

  <canvas id="gameCanvas"></canvas>
  <div id="character-anchor"></div>

  <img id="ground"
       src="images/file_00000000ba6471f4917611ec1970cd28-removebg-preview.png" />

  <div id="joystick-base">
    <div id="joystick-stick"></div>
  </div>

  <script>
    /* =====================
       CANVAS SETUP
       ===================== */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    ctx.imageSmoothingEnabled = false;

    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      canvas.width = window.innerWidth * dpr;
      canvas.height = window.innerHeight * dpr;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    /* =====================
       LOAD & HARD-CROP SPRITE
       ===================== */
    const rawSprite = new Image();
    rawSprite.src = 'images/Character1.png';

    const frameWidth = 120;
    const frameHeight = 160;

    // ðŸ”¥ OFFSCREEN CLEAN SPRITE
    const cleanSpriteCanvas = document.createElement('canvas');
    cleanSpriteCanvas.width = frameWidth;
    cleanSpriteCanvas.height = frameHeight;
    const cleanCtx = cleanSpriteCanvas.getContext('2d');
    cleanCtx.imageSmoothingEnabled = false;

    rawSprite.onload = () => {
      // Copy ONLY the green (top) frame
      cleanCtx.clearRect(0, 0, frameWidth, frameHeight);
      cleanCtx.drawImage(
        rawSprite,
        0, 0,
        frameWidth, frameHeight,
        0, 0,
        frameWidth, frameHeight
      );
    };

    /* =====================
       CHARACTER POSITION
       ===================== */
    const anchor = document.getElementById('character-anchor');

    function getCharacterPos() {
      const r = anchor.getBoundingClientRect();
      return { x: r.left, y: r.top };
    }

    /* =====================
       BACKGROUND
       ===================== */
    const wall = new Image();
    wall.src = 'images/wall.jpg';
    let wallX = 0;

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!wall.complete || !rawSprite.complete) return;

      ctx.drawImage(wall, wallX, 0, canvas.width, canvas.height);

      const pos = getCharacterPos();

      // âœ… DRAW CLEAN, SINGLE-FRAME SPRITE
      ctx.drawImage(
        cleanSpriteCanvas,
        pos.x,
        pos.y,
        frameWidth,
        frameHeight
      );

      requestAnimationFrame(draw);
    }

    Promise.all([
      new Promise(r => wall.onload = r),
      new Promise(r => rawSprite.onload = r)
    ]).then(draw);
  </script>

</body>
</html>
