<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shadow Fighter Mobile</title>
    <style>
        body { 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            background: #000; 
            font-family: sans-serif; 
            touch-action: none;
        }

        canvas { 
            display: block; 
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1; /* Character and background wall are here */
        }

        /* --- CSS HARDCODED GROUND --- */
        #ground-layer {
            position: absolute;
            /* EDIT THESE TO CONTROL THE GROUND */
            bottom: 0px; 
            height: 100px; 
            width: 100%; /* Only visually spans the screen */
            
            background-image: url('images/ground.png');
            background-repeat: no-repeat;
            background-position: left bottom;
            background-size: contain;
            
            z-index: 10; /* Ensures it stays in front of the character */
            pointer-events: none; /* Clicks pass through to buttons */
        }

        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            box-sizing: border-box;
            z-index: 20; /* Above the ground */
        }
        
        .btn {
            width: 70px; height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold;
            pointer-events: auto;
            user-select: none;
        }

        #rotate-message {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: white;
            z-index: 100; justify-content: center; align-items: center;
        }
        @media (orientation: portrait) { #rotate-message { display: flex; } }
    </style>
</head>
<body>

<div id="rotate-message">Please rotate to Landscape</div>

<div id="ground-layer"></div>

<div class="controls">
    <div style="display: flex; gap: 20px;">
        <div class="btn" id="btnLeft">←</div>
        <div class="btn" id="btnRight">→</div>
    </div>
    <div class="btn" id="btnJump">JUMP</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const groundDiv = document.getElementById('ground-layer');

const wallImg = new Image();
wallImg.src = 'images/wall.jpg';

const WORLD_WIDTH = 5000;
const GRAVITY = 0.8;
const FRICTION = 0.85;

let touchKeys = { left: false, right: false, jump: false };

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

const camera = {
    x: 0,
    follow(target) {
        let targetX = target.x - canvas.width / 2 + target.width / 2;
        this.x += (targetX - this.x) * 0.1;
        this.x = Math.max(0, Math.min(this.x, WORLD_WIDTH - canvas.width));
    }
};

const player = {
    x: 150, y: 0,
    width: 40, height: 80,
    velX: 0, velY: 0,
    speed: 7, jumpForce: -16,
    grounded: false,

    update() {
        if (touchKeys.right) this.velX = this.speed;
        else if (touchKeys.left) this.velX = -this.speed;
        else this.velX *= FRICTION;

        if (touchKeys.jump && this.grounded) {
            this.velY = this.jumpForce;
            this.grounded = false;
        }

        this.velY += GRAVITY;
        this.x += this.velX;
        this.y += this.velY;

        // SYNC PHYSICS TO CSS GROUND
        // We get the height of the CSS div to know where to stop the player
        const groundHeight = groundDiv.offsetHeight;
        const groundTop = canvas.height - groundHeight;

        if (this.y + this.height > groundTop) {
            this.y = groundTop - this.height;
            this.velY = 0;
            this.grounded = true;
        }
    },

    draw() {
        ctx.fillStyle = "black";
        ctx.fillRect(this.x - camera.x, this.y, this.width, this.height);
    }
};

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const groundHeight = groundDiv.offsetHeight;
    const groundTop = canvas.height - groundHeight;

    // 1. Background Wall
    if (wallImg.complete) {
        const wallX = -(camera.x * 0.4);
        for (let i = 0; i < WORLD_WIDTH; i += wallImg.width) {
            ctx.drawImage(wallImg, i + wallX, groundTop - wallImg.height);
        }
    }

    // 2. Player (Drawn on canvas, but looks "behind" the CSS ground because of z-index)
    player.update();
    camera.follow(player);
    player.draw();

    // 3. Ground Parallax Effect
    // Since the ground is CSS, we move the background-position to follow the camera
    groundDiv.style.backgroundPosition = `calc(0% - ${camera.x}px) bottom`;

    requestAnimationFrame(loop);
}

const setupBtn = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e) => { e.preventDefault(); touchKeys[key] = true; });
    el.addEventListener('touchend', (e) => { e.preventDefault(); touchKeys[key] = false; });
};

setupBtn('btnLeft', 'left');
setupBtn('btnRight', 'right');
setupBtn('btnJump', 'jump');

loop();
</script>
</body>
</html>

